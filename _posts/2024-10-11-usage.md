---
title: Usage
date: 2024-10-11
categories: HackTheBox Easy
tags:
  - HTB
  - Usage
image:
  path: /assets/htb/Screenshot 2024-10-17 at 19.53.46.png
---

# MÃ´ táº£
ğŸ¤ŸğŸ»ğŸ¤ŸğŸ»ğŸ¤ŸğŸ» Yeah vÃ o thá»© 6 ngÃ y 11 chá»© k pháº£i 13 nhÃ© ğŸ‘», sau khi hoÃ n thÃ nh cÃ´ng viá»‡c Ä‘Æ°á»£c giao á»Ÿ cty cÃ²n chÃºt thá»i gian buá»•i chiá»u mÃ¬nh lÃ m nháº¹ má»™t bÃ i HackTheBox, nhÆ° báº¡n Ä‘Ã£ biáº¿t vÃ  tÃ¬m kiáº¿m vá» nÃ³ thÃ¬ Ä‘Ãºng rá»“i bÃ i HTB nÃ y cÃ³ tÃªn lÃ  Usage.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 11.42.38.png)

Äá»c sÆ¡ vá» thÃ´ng tin machine tÃ´i biáº¿t Ä‘Æ°á»£c ráº±ng machine nÃ y lÃ  má»™t linux server vÃ  Ä‘ang deploy má»™t web site blog cÃ³ tá»“n táº¡i lá»— há»•ng SQL Injection. VÃ  cÃ²n nhiá»u Ä‘iá»u thÃº vá»‹ khÃ¡c nhÆ° hÃ¬nh bÃªn dÆ°á»›i.

![Screenshot](/assets/htb/Screenshot 2024-10-11 at 16.19.44.png)

# Attack
Start machine tÃ´i nháº­n Ä‘Æ°á»£c má»™t IP: 10.129.5.101
## Recon
NhÆ° cÃ¡c thanh niÃªn má»›i táº­p tÃ nh lÃ m hacker, tÃ´i tiáº¿n hÃ nh scan nmap Ä‘á»ƒ xem ip trÃªn Ä‘ang cháº¡y nhá»¯ng dá»‹ch vá»¥ nÃ o.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 11.48.37.png)

Viá»‡c scan nmap trÃªn mÃ¡y tÃ´i cÃ³ váº» khÃ¡ lÃ¢u, trong lÃºc chá» Ä‘á»£i thá»­ truy cáº­p ip Ä‘Ã³ vÆ¡i port 80 vÃ o trÃ¬nh duyá»‡t thá»­ xem cÃ³ gÃ¬ hay ho khum (báº£n nÄƒng cá»§a má»™t web application pentester).

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 11.49.14.png)

TÃ´i bá»‹ dÃ¬ Ä‘ai dÃ©c (redirect) qa domain *usage.htb* nhÆ° hÃ¬nh trÃªn. KhÃ´ng láº½ pháº£i khai bÃ¡o host cho ip Ä‘Ã³ thÃ¬ má»›i cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c hay sao ? Thá»­ khai bÃ¡o thÃªm host (cho báº¡n nÃ o chÆ°a biáº¿t, cÃ¡c báº¡n cÃ³ thá»ƒ khai bÃ¡o host táº¡i file `/etc/hosts` Ä‘á»‘i vá»›i linux, cÃ²n windows báº¡n cÃ³ thá»ƒ google thÃªm nhÃ©, mÃ¬nh qÃªn máº¥t path windows ráº§u ğŸ˜…) vÃ  truy cáº­p láº¡i xem nhÆ° tháº¿ nÃ o nhÃ©.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 11.54.27.png)

May quÃ¡ tÃ´i truy cáº­p Ä‘Æ°á»£c rá»“i. CÃ¹ng lÃºc Ä‘Ã³ nmap cá»§a tÃ´i cÅ©ng Ä‘Ã£ cho [káº¿t quáº£](/assets/htb/Screenshot 2024-10-14 at 11.48.37.png).
Tiáº¿n hÃ nh scan sÃ¢u thÃªm xÃ­u Ä‘á»ƒ láº¥y thÃªm má»™t vÃ i thÃ´ng tin vá» 2 dá»‹ch vá»¥ 22 vÃ  80.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 12.03.18.png)

CÅ©ng khÃ´ng cÃ³ gÃ¬ qÃ¡ Ä‘áº·c sáº¯c, quay láº¡i vs cÃ¡i site *usage.htb* tÃ´i vá»«a truy cáº­p Ä‘Æ°á»£c.
Äi má»™t vÃ²ng site Ä‘Ã³ tÃ´i collect láº¡i cÃ¡c endpoint nhÆ° sau:
```
GET: /dashboard
GET: /login
GET: /registration
GET: /forget-password
GET: admin.usage.htb/
POST: /post-login
POST: /post-registration
POST: /forget-password
```
## Fuzzing
Tá»« kinh nghiá»‡m non ná»›t cá»§a má»™t redteam má»›i vÃ o nghá», tÃ´i sáº½ Æ°u tiÃªn fuzz cÃ¡c lá»— há»•ng server side trÆ°á»›c Ä‘á»ƒ nhanh chÃ³ng RCE Ä‘Æ°á»£c. CÃ¡c payload cÆ¡ báº£n cá»§a cÃ¡c bug server side Ä‘á»u cÃ³ sáºµn á»Ÿ *seclists*.
Fuzz qua má»™t vÃ²ng tÃ´i Ä‘Ã£ phÃ¡t hiá»‡n lá»— há»•ng SQLi á»Ÿ form forget password. LÆ°á»i khai thÃ¡c quÃ¡ :))) => SQLMAP cho láº¹ thÃ´i ğŸ¤£ğŸ¤£ğŸ¤£

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 14.04.00.png)

## SQL Injection
![Screenshot](/assets/htb/Screenshot 2024-10-14 at 14.08.10.png)

Káº¿t quáº£ SQLmap Ä‘Ã£ ra nhÆ° v rá»“i thÃ¬ cÃ²n nghi ngá» gÃ¬ ná»¯a mÃ  k attack tháº³ng luÃ´n â˜ºï¸
ThÃªm cÃ¡c option tools gá»£i Ã½ vÃ  xÃºc thÃ´i

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 14.10.32.png)

á» Ä‘Ã¢y mÃ¬nh trá» proxy vá» burp cho dá»… theo dÃµi payload.
Sqlmap cháº¡y khÃ¡ lÃ¢u nÃªn mÃ¬nh Ä‘Ã£ Ä‘i cf má»™t lÃºc :))). Sau khi cf vá» thÃ¬ káº¿t quáº£ cho tháº¥y chÃºng ta cÃ³ má»™t *SQLi blind* vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ  *mysql*

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 14.25.45.png)

Láº¡i pháº£i trÃ´ng cáº­y vÃ o sqlmap Ä‘á»ƒ dump db vá» thÃ´i chá»© mÃ¬nh lÆ°á»i khai thÃ¡c tay hoáº·c viáº¿t tool quÃ¡ kkkk.
Sá»‘ trá»i báº¯t mÃ¬nh pháº£i khai thÃ¡c báº±ng tay rá»“i cÃ¡c báº¡n Æ¡i. Dump sá»­ dá»¥ng cáº£ wordlist nhÆ°ng váº«n khÃ´ng thÃ nh cÃ´ng.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 14.56.32.png)

ThÃ´i thÃ¬ mÃ¬nh sáº½ táº­n dá»¥ng láº¡i cÃ¡i payload mÃ  sqlmap cung cáº¥p Ä‘á»ƒ khai thÃ¡c tiáº¿p báº±ng tay (manual) váº­y.
Tá»•ng há»£p láº¡i má»™t tÃ­ thÃ¬ Ä‘Ã¢u lÃ  SQLi blind vÃ  payload mÃ  sqlmap cung cáº¥p á»Ÿ dáº¡ng error base. MÃ¬nh paste láº¡i payload Ä‘á»ƒ phÃ¢n tÃ­ch má»™t tÃ½.
`' AND EXTRACTVALUE(9050,CASE WHEN (9050=9050) THEN 9050 ELSE 0x3A END) AND 'iBUN'='iBUN`
NÃ³ sá»­ dá»¥ng hÃ m `EXTRACTVALUE`, Ä‘Ã¢y lÃ  má»™t hÃ m trong háº§u háº¿t cÆ¡ sá»Ÿ dá»¯ liá»‡u mÃ  cá»¥ thá»ƒ á»Ÿ Ä‘Ã¢y lÃ  mysql. NÃ³ dÃ¹ng Ä‘á»ƒ láº¥y dá»± liá»‡u tá»« má»™t tÃ i liá»‡u XML vá»›i 2 tham sá»‘ Ä‘áº§u vÃ o.
Tham sá»‘ Ä‘áº§u tiÃªn thÆ°á»ng sáº½ lÃ  má»™t tÃ i liá»‡u XML hoáº·c lÃ  má»™t sá»‘ báº¥t ká»³ nÃ o Ä‘Ã³.
Tham sá»‘ thá»© 2 sáº½ lÃ  XPATH trá» Ä‘áº¿n tÃ i liá»‡u Ä‘Ã³.
Trong payload nÃ y 2 tham sá»‘ láº§n lÆ°á»£t sáº½ lÃ  `9050` vÃ  `CASE WHEN (9050=9050) THEN 9050 ELSE 0x3A END)`
MÃ¬nh sáº½ phÃ¢n tÃ­ch vÃ o tham sá»‘ thá»© 2 nhÃ©. ÄÃ¢y lÃ  má»™t biá»ƒu thá»©c Ä‘iá»u kiá»‡n, náº¿u `9050=9050` => luÃ´n Ä‘Ãºng thÃ¬ sáº½ tráº£ vá» `9050` ngÆ°á»£c láº¡i sáº½ tráº£ vá» `0x3A` lÃ  mÃ£ hex cá»§a `:`.
Bá» vÃ o burp thá»­ chÃºng ta sáº½ nháº­n ra ráº±ng trong trÆ°á»ng há»£p Ä‘Ãºng response sáº½ cÃ³ mÃ£ 302 ngÆ°á»£c láº¡i sáº½ lÃ  500.
OK. BÃ¢y giá» sáº½ edit láº¡i payload Ä‘á»ƒ get version thá»­ nhÃ©. TrÆ°á»›c tiÃªn mÃ¬nh sáº½ tÃ¬m Ä‘á»™ dÃ i cá»§a version sáº½ cÃ³ bao nhiÃªu kÃ½ tá»± vÃ  payload tÃ¬m Ä‘á»™ dÃ i nhÆ° sau:
`' AND EXTRACTVALUE(9050,CASE WHEN ((select length(@@version))>20) THEN 9050 ELSE 0x3A END) AND 'iBUN'='iBUN`
Káº¿t quáº£ cá»§a payload trÃªn tráº£ vá» 302 cÃ³ nghÄ©a lÃ  Ä‘Ãºng, Ä‘á»™ dÃ i cá»§a version mysql lá»›n hÆ¡n 20 kÃ½ tá»±. Tiáº¿p tá»¥c fuzz Ä‘áº¿n khi nÃ o ra Ä‘á»™ dÃ i chÃ­nh xÃ¡c thÃ¬ thÃ´i. => Ä‘á»™ dÃ i chÃ­nh xÃ¡c lÃ  23
Má»¥c tiÃªu chÃ­nh cá»§a mÃ¬nh Ä‘Ã¢u pháº£i chá»‰ tÃ¬m version Ä‘Ã¢u Ä‘Ãºng k ? Cho nÃªn viá»‡c xÃ¡c Ä‘á»‹nh Ä‘á»™ dÃ i chá»‰ Ä‘á»ƒ chá»©ng minh ráº±ng idea sá»­a payload cá»§a mÃ¬nh thÃ nh cÃ´ng. Tiáº¿p tá»¥c vá»›i idea Ä‘Ã³ mÃ¬nh sáº½ Ä‘i tÃ¬m táº¥t cáº£ cÃ¡c table cÃ³ trong db `mysql`.
Vá»›i payload dÆ°á»›i Ä‘Ã¢y mÃ¬nh sáº½ sá»­ dá»¥ng intruder cá»§a burp Ä‘á»ƒ bruteforce tá»«ng kÃ½ tá»± vá»›i Ä‘á»™ dÃ i 371 cho má»—i vá»‹ trÃ­ cá»§a cÃ¡c table cÃ³ trong db `mysql`. Payload: ` AND EXTRACTVALUE(9050,CASE WHEN ((select substr(group_concat(table_name),1,1) from information_schema.tables WHERE table_schema != 'information_schema')='g') THEN 9050 ELSE 0x3A END) AND 'iBUN'='iBUN`.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 15.42.19.png)

Ngol lÃ nh, sáº¿p xáº¿p láº¡i 1 tÃ½ Ä‘á»ƒ cÃ³ full table thÃ´i nÃ o.
VÃ  Ä‘Ã¢y lÃ  danh sÃ¡ch table cÃ³ trong db `mysql` mÃ  mÃ¬nh vá»«a dump Ä‘Æ°á»£c.
`global_status,global_variables,persisted_variables,processlist,session_account_connect_attrs,session_status,session_variables,variables_info,admin_menu,admin_operation_log,admin_permissions,admin_role_menu,admin_role_permissions,admin_role_users,admin_roles,admin_user_permissions,admin_users,blog,failed_jobs,migrations,password_reset_tokens,personal_access_tokens,users`
Tá»« Ä‘Ã¢y mÃ¬nh sáº½ focus vÃ o 2 table `admin_user` vÃ  `users` Ä‘áº§u tiÃªn Ä‘áº¿n xem hÃºp Ä‘Æ°á»£c gÃ¬ khÃ´ng. Tiáº¿p tá»¥c tÃ¬m column vÃ  dump data 2 table Ä‘Ã³.
> Column name table users: `id,name,email,email_verified_at,password,remember_token,created_at,updated_at`
> Column name table admin_users: I`d,username,password,name,avatar,remember_token,created_at,updated_at`
> Báº£ng `admin_users` chá»‰ cÃ³ Ä‘Ãºng má»™t dÃ²ng vá»›i user,pass: `admin:$2y$10$ohq2klpbh/ri.p5wr0p3uomc24ydvl9da9h1s6ooomgh5xvfuprl2`

ÄÃ£ cÃ³ pass dáº¡ng hash, mÃ¬nh k biáº¿t Ä‘Ã¢y lÃ  dáº¡ng mÃ£ hoÃ¡ nÃ o. ThÃ´i thá»­ cá»© Ä‘á»ƒ hashcat detect xem sao. NhÆ°ng trÆ°á»›c tiÃªn tÃ´i sáº½ thá»­ vá»›i cÃ¡c cÃ´ng cá»¥ online trÆ°á»›c.

![Screenshot](/assets/htb/Screenshot 2024-10-14 at 23.44.28.png)

CÃ´ng cá»¥ crack online báº£o mÃ¬nh ráº±ng Ä‘Ã¢y lÃ  má»™t bcrypt nhÆ°ng nÃ³ k crack Ä‘Æ°á»£c. ThÃ´i thÃ¬ mÃ¬nh sáº½ thá»­ vá»›i cÃ´ng cá»¥ tháº§n thÃ¡nh hashcat xem sao.
Sau gáº§n 3 tiáº¿ng ngá»“i crack báº±ng hashcat nhÆ°ng váº«n khÃ´ng nháº­n Ä‘Æ°á»£c káº¿t quáº£, mÃ¬nh chuyá»ƒn sang hÆ°á»›ng tim cÃ¡c user thÆ°á»ng xem cÃ³ idea gÃ¬ má»›i khÃ´ng.
Quay láº¡i vá»›i báº£ng `users`.
> ÄÃ£ tÃ¬m Ä‘Æ°á»£c thÃ´ng tin cÃ¡c user trong báº£ng `users`

```
raj@raj.com:$2y$10$7almtteyfrvd8rnyep/ck.bsfkfxfsltplkyqqsp/tt7x1wapjt4.
raj@usage.htb:$2y$10$rbncgxpwp1hspo1gqx4upo.pdg1nszoi/uhwhvfhddfdfo9vmdjsa
a@gmail.com:$2y$10$40rwm43ejd7p04jgtvdm7exuw1ygu7thg5r6bwmtwgmkiegpg.zay
b@gmail.com:$2y$10$nctkiwzoakyk0jhvstkhfonm6qvoeoodklb8ymisv69bwhgsyjko6
```
Ngoáº¡i trá»« 2 account `a` vÃ  `b` mÃ¬nh táº¡o ra thÃ¬ cÃ²n láº¡i 2 account `raj@raj.com` vÃ  `raj@usage.htb`. Thá»­ crack bcrypt cá»§a nÃ³ xem nhÆ° tháº¿ nÃ o ?
Hashcat cháº¡y quÃ¡ lÃ¢u, mÃ  mÃ¬nh quÃªn máº¥t ngoÃ i hashcat ra thÃ¬ váº«n cÃ²n john ripper tháº§n thÃ¡nh. Chuyá»ƒn qua sá»­ dá»¥ng john xem cÃ³ tiáº¿n triá»ƒn gÃ¬ hÆ¡n khum.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 10.00.40.png)

Trá»i tháº­t khÃ´ng phá»¥ lÃ²ng ngÆ°á»i, cuá»‘i cÃ¹ng cÅ©ng crack Ä‘Æ°á»£c pass admin. Login tÃ¬m Ä‘Æ°á»ng RCE thÃ´i nÃ o !!!!

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 10.02.35.png)

Ngol lÃ nh luÃ´n.
Sau khi Ä‘i 1 vÃ²ng táº¥t cáº£ cÃ¡c chá»©ng nÄƒng sau khi login. ThÃ¬ chá»‰ cÃ³ form táº¡o hoáº·c sá»­a user lÃ  cÃ³ chá»©c nÄƒng upload => cÃ³ kháº£ nÄƒng lÃªn shell.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 10.39.49.png)

Tuy nhiÃªn Ä‘á»i k nhÆ° lÃ  mÆ¡. Chá»©c nÄƒng cÃ³ cÅ©ng nhÆ° khÃ´ng. API thÃ¬ cháº¡y nhÆ°ng user láº¡i k Ä‘Æ°á»£c táº¡o ra. ÄI theo avatar cá»§a user admin Ä‘á»ƒ tÃ¬m nÆ¡i chá»©a hÃ¬nh áº£nh Ä‘Ã£ up Ä‘á»ƒ trigger shell nhÆ°ng cÅ©ng k Ä‘Æ°á»£c. => Quay xe thÃ´i.
Quay láº¡i quÃ¡ trÃ¬nh recon web ban Ä‘áº§u. MÃ¬nh váº«n cÃ²n cÃ¡c version chÆ°a biáº¿t cÅ© má»›i. Äáº§u tiÃªn lÃ  nginx 1.18.0

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 10.42.57.png)

Kháº£ nÄƒng cao lÃ  cÃ³ CVE vÃ¬ mÃ¬nh nghi Ä‘Ã¢y chÆ°a pháº£i version latest. Google xÃ­u nÃ o.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 10.44.02.png)

POC cÃ¡c thá»© 1 há»“i váº«n k Äƒn thua => Láº¡i quay xe tÃ¬m Ä‘Æ°á»£c khÃ¡c thÃ´i.
NhÆ° hÃ¬nh trÃªn thÃ¬ version cá»§a PHP vs Laravel chÆ°a Ä‘Æ°á»£c list ra. Ã€ hÃ¡ hÃ¬nh nhÆ° khi login vÃ o dashboard nÃ³ Ä‘Æ°á»£c hiá»‡n thá»‹.
PHP 8.1.2 cÃ³ váº» khÃ¡ to. ThÃ´i thá»­ tÃ¬m Laravel xem s, nhÃ¬n ver nhá» hÆ¡n nhiá»u so vá»›i latest.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 11.06.39.png)

NÃ³ Ä‘Ã¢y rá»“i, thá»­ xem POC Ä‘Æ°á»£c khum nha.
Láº¡i khÃ³ rá»“i mÃ¬nh thiáº¿u file .log cá»§a laravel nÃªn khÃ³ mÃ  POC Ä‘Æ°á»£c. ThÃ´i thÃ¬ bung js ra Ä‘á»c thÃ´i.
VÃ¬ endpoint mÃ¬nh cÅ©ng Ä‘Ã£ Ä‘i háº¿t rá»“i, tÃ¬m version POC CVE thÃ¬ cÅ©ng váº­y. => Viá»‡c Ä‘á»c js Ä‘á»ƒ tÃ¬m gÃ¬ nhá»‰ ? kkkkk táº¥t nhiÃªn lÃ  sáº½ tÃ¬m nhá»¯ng endpoint hoáº·c version áº©n nÃ o Ä‘Ã³. áº®t háº³n lÃ  cÃ¡c báº¡n Ä‘ang tháº¯c máº¯c version áº©n lÃ  gÃ¬ Ä‘Ãºng khÃ´ng. VÃ¬ Ä‘Ã¢y lÃ  CMS Laravel nÃ³ na nÃ¡ nhÆ° Wordpress váº­y Ã¡ nÃªn viá»‡c quáº£n trá»‹ viÃªn sá»­ dá»¥ng thÃªm cÃ¡c plugin thá»© 3 lÃ  cÃ³ thá»ƒ cÃ³.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 11.19.13.png)

Search keyword `version` thÃ¬ cÃ³ 3 káº¿t quáº£.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 11.19.52.png)

2 káº¿t quáº£ Ä‘áº§u Ä‘Ã£ Ä‘Æ°á»£c hiá»‡n thá»‹ á»Ÿ dashboard rá»“i. Váº­y cÃ²n káº¿t quáº£ thá»© 3 lÃ  gÃ¬ nhá»‰ ?

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 11.20.47.png)

Version 1.8.17 nhÆ°ng cá»§a cÃ¡i gÃ¬ thÃ¬ mÃ¬nh cÅ©ng k rÃµ chá»‰ Ä‘oÃ¡n Ä‘Ã¢y lÃ  1 plugin nÃ o Ä‘Ã³ cá»§a Laravel. KhÃ´ng biáº¿t thÃ¬ google thÃ´i chá»© dÃ¬ Ä‘ou mÃ  ngáº¡i kkkk
Ngá»“i google má»™t lÃºc lÃ¢u má»›i phÃ¡t hiá»‡n version 1.8.17 nÃ y lÃ  cá»§a laravel-admin. May thay mÃ¬nh Ä‘i lÃ²ng vÃ²ng trÃªn khÃ´ng gian máº¡ng thÃ¬ lÃ²i ra Ä‘Æ°á»£c cÃ¡i site nÃ³i vá» [CVE cá»§a laravel-admin nÃ y](https://flyd.uk/post/cve-2023-24249/). NÃ³ láº¡i cÃ²n cÃ³ vÃ­ dá»¥ ik chang cÃ¡i site mÃ¬nh Ä‘ang attack ná»¯a chá»©.
Ã Ä‘Ã¹ nÃ³ chÃ­nh lÃ  cÃ¡i chá»©c nÄƒng upload mÃ  há»“i nÃ£y mÃ¬nh Ä‘Ã£ attack nhÆ°ng nghÄ© nÃ³ k work. LÃ m theo sÃ¡ch giao khoa khÃ´ng up shell Ä‘Æ°á»£c thÃ¬ bÃ¢y giá» mÃ¬nh thá»­ lÃ m theo cuá»‘n chÃ¢n kinh mÃ¬nh má»›i tÃ¬m Ä‘Æ°á»£c xem sao nhá»‰.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 11.41.31.png)

Yeah cuá»‘i cÃ¹ng cÅ©ng lÃªn Ä‘Æ°á»£c con shell gháº» kkkk.
> Loay hoay 1 há»“i vÃ o Ä‘á»c chÃ¢n kinh má»›i ngá»™ ra ráº±ng. CÃ¡i chá»©c nÄƒng upload á»Ÿ function táº¡o user k work thiá»‡t. MÃ  pháº£i sá»­ dá»¥ng chá»©c nÄƒng upload á»Ÿ function edit user admin.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 11.47.03.png)

Khi lÃªn Ä‘Æ°á»£c shell thÃ¬ viá»‡c láº¥y flag Ä‘áº§u tiÃªn ez rá»“i.
## Privilege Escalation
HÃ¬nh nhÆ° khu vá»±c nÆ¡i chá»©a file upload cá»§a admin Ä‘ang Ä‘Æ°á»£c cháº¡y 1 script auto táº¡o láº¡i file avatar cá»§a admin. NÃªn cá»© up web shell lÃªn chÆ°a Ä‘Æ°á»£c 10p thÃ¬ web shell cá»§a mÃ¬nh bá»‹ xoÃ¡ vÃ  trá»Ÿ láº¡i lÃ  hÃ¬nh avatar cá»§a admin. HÆ¡i khÃ³ cháº¹o nÃªn mÃ¬nh quyáº¿t Ä‘á»‹nh sáº½ up má»™t con reverse shell vÃ o thÆ° má»¥c `/tmp`.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 14.47.09.png)

OK, cÃ³ revershell thÃ nh cÃ´ng. NhÆ°ng con reverseshell nÃ y váº«n cÃ²n khÃ³ cháº¹o, mÃ¬nh k thá»ƒ sudo hay lÃ m 1 vÃ i thao tÃ¡c nÃ¢ng cao. NÃªn cháº¯c mÃ¬nh sáº½ tÃ¬m cÃ¡ch get Ä‘Ãºng shell cá»§a user dash trÆ°á»›c khi leo quyá»n.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 14.49.16.png)

Idea cÆ¡ báº£n nháº¥t lÃ  mÃ¬nh sáº½ tÃ¬m cÃ¡ch láº¥y key `ssh` vÃ¬ há»“i lÃºc recon mÃ¬nh nhá»› váº«n cÃ²n port 22 chÆ°a Ä‘á»¥ng Ä‘áº¿n.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 14.51.23.png)

Yeah Ä‘i vÃ o profile user vÃ  thÆ° má»¥c máº·c Ä‘á»‹nh cá»§a ssh lÃ  sáº½ tháº¥y thÃ´i. (`/home/user/.ssh/`).

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 14.54.56.png)

Yeah ngol lÃ nh, báº¯t cÃ¡i thang lÃªn leo thÃ´i.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 15.18.22.png)
![Screenshot](/assets/htb/Screenshot 2024-10-15 at 15.18.42.png)
![Screenshot](/assets/htb/Screenshot 2024-10-15 at 15.43.03.png)

Gáº§n nhÆ° cÃ¡c ká»¹ thuáº­t leo quyá»n cÆ¡ báº£n Ä‘á»u khÃ´ng kháº£ dá»¥ng trong trÆ°á»ng há»£p nÃ y.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 15.28.17.png)

Yeah cÃ¡c binary dÆ°á»›i Ä‘Ã¢y Ä‘ang Ä‘Æ°á»£c cháº¡y vá»›i quyá»n `root`. TÃ¬m cÃ¡ch hÃºp nÃ³ thÃ´i.
MÃ¬nh sáº½ focus vÃ o cÃ¡c binary trong nhÃ³m `/usr/bin` trÆ°á»›c. MÃ¬nh nghÄ© Ä‘a sá»‘ cÃ¡c binary nÃ y Ä‘Ã£ tá»«ng cÃ³ Ã­t nháº¥t 1 CVE nÃ o Ä‘Ã³. ThÃ´i thÃ¬ mÃ¬nh sáº½ check version cá»§a tá»«ng binary rá»“i so vá»›i cÃ¡c CVE cá»§a chÃºng thá»­ xem cÃ³ thá»ƒ khai thÃ¡c cÃ¡i nÃ o hay k nhÃ©.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 15.54.39.png)

Äi má»™t vÃ²ng thÃ¬ mÃ¬nh phÃ¡t hiá»‡n ra tháº±ng `pkexec` cÃ³ váº» phÃ¹ há»£p vÃ  cÅ©ng cÃ³ sáºµn POC trÃªn [git](https://github.com/mebeim/CVE-2021-4034) luÃ´n. Chá» dÃ¬ ná»¯a mÃ  k thá»­ exploit.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 16.29.09.png)

TÆ°á»Ÿng dá»… Äƒn nhÆ°ng váº«n k Äƒn Ä‘Æ°á»£c. Láº¡i pháº£i quay xe. Chá»£t nhá»› ra tÃ´i chÆ°a kiá»ƒm tra xem internal cÃ³ Ä‘ang má»Ÿ port nÃ o cÃ³ thá»ƒ tunnel ra ngoÃ i Ä‘Æ°á»£c khum nhá»‰ ?

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 16.42.48.png)

Váº«n khÃ´ng tÃ¬m tháº¥y gÃ¬ hot haizzz. Quáº±ng quÃ¡ bá» Ä‘i chÆ¡i ......
Sau khi Ä‘i chÆ¡i vá» mÃ¬nh láº¡i tiáº¿p tá»¥c connect vÃ o ssh vÃ  Ä‘i lÃ²ng vÃ²ng xem cÃ³ gÃ¬ hot Ä‘á»ƒ khai thÃ¡c khÃ´ng. Láº§n nÃ y mÃ¬nh mÃ² lÃ²ng vÃ²ng trong src web láº«n profile user. 
Máº·c dÃ¹ mang tiáº¿ng lÃ  dÃ¹ng linux nhiá»u hÆ¡n dÃ¹ng win nhÆ°ng nhÃ¬n vÃ o profile user váº«n cÃ³ nhiá»u file mÃ¬nh khÃ´ng thá»ƒ hiá»ƒu Ä‘Æ°á»£c.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 16.47.11.png)

MÃ¬nh tháº¯c máº¯c cÃ¡c file nhÆ° `.lesshst`, `monit*` lÃ  gÃ¬ nhá»‰ ? KhÃ´ng hiá»ƒu thÃ¬ há»i thÃ´i, Ä‘em lÃªn google há»i nÃ o.
ThÃ¬ ra file `.lesshst` lÃ  file lá»‹ch sá»­ Ä‘Æ°á»£c táº¡o ra bá»Ÿi lá»‡nh less.
CÃ²n cÃ¡c file `.monit*` lÃ  do server Ä‘ang cháº¡y má»™t dá»‹ch vá»¥ monitor (giÃ¡m sÃ¡t) mÃ£ nguá»“n má»Ÿ. NÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ theo dÃµi vÃ  quáº£n lÃ½ cÃ¡c dá»‹ch vá»¥, tiáº¿n trÃ¬nh, vÃ  tÃ i nguyÃªn há»‡ thá»‘ng trÃªn cÃ¡c há»‡ Ä‘iá»u hÃ nh giá»‘ng Unix. Google sÃ¢u vá» dá»‹ch vá»¥ nÃ y thÃ¬ mÃ¬nh tháº¥y thÃ´ng thÆ°á»ng nÃ³ sáº½ open má»™t port 2812 Ä‘á»ƒ quáº£n trá»‹ viÃªn cÃ³ thá»ƒ dá»… dÃ ng quáº£n trá»‹ server tá»« xa thÃ´ng qua trÃ¬nh duyá»‡t. Tháº¿ thÃ¬ ngáº¡i gÃ¬ mÃ  k thá»­ truy cáº­p vÃ o port Ä‘Ã³ xem ntn nhá»‰.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 16.53.58.png)

LÆ°á»i má»Ÿ trÃ¬nh duyá»‡t qÃ¡ nÃªn mÃ¬nh dÃ¹ng `curl` luÃ´n. NÃ³ kÃªu mÃ¬nh k cÃ³ quyá»n. MÃ¬nh Ä‘ang Ä‘á»©ng á»Ÿ server cháº¡y nÃ³ mÃ  nÃ³ dÃ¡m lÃ m khÃ³ mÃ¬nh. Äá»c thá»­ cÃ¡c file `monit*` xem cÃ³ gÃ¬ hot nÃ o.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 16.55.37.png)

á»i cÃ³ tÃ i khoáº£n admin kÃ¬a.
Hmmm, trÃ¬nh duyá»‡t thÃ¬ k dÃ¹ng Ä‘Æ°á»£c tháº¿ thÃ¬ tÃ i khoáº£n nÃ y dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬ cÃ  ? MÃ¬nh váº«n cÃ²n tÃ i khoáº£n `xander` vÃ  `root` chÆ°a login Ä‘Æ°á»£c. NhÆ°ng tÃ i khoáº£n `dash` mÃ¬nh váº«n chÆ°a cÃ³ password. Thá»­ háº¿t cáº£ 3 tÃ i khoáº£n xem ntn.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.03.25.png)

NÃ³ lÃ  tháº±ng `xander`. Tháº±ng nÃ y cÃ³ dÃ¬ nhá»‰. Láº¡i mÃ² profile nÃ³ thÃ´i kkkkk

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.05.20.png)

Máº·c dÃ¹ biáº¿t lÃ  k Ä‘Æ°á»£c Ä‘Ã¢u nhÆ°ng váº«n cá»‘ cháº¥p xem ntn kkkk

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.06.13.png)

Leo `root` Ä‘Ã£ trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n khi báº¡n cÃ³ password vÃ  cháº¡y Ä‘Æ°á»£c lá»‡nh `sudo -l` ğŸ¤£ğŸ¤£ğŸ¤£
NÃ³ lÃ  má»™t file binary do quáº£n trá»‹ dev. Hmm k láº½ RE file nÃ y Ä‘á»ƒ Ä‘á»c code nÃ³ ta ğŸ¤”. Thá»­ `strings` nÃ³ ra trÆ°á»›c xem cÃ³ chuá»—i j hay ho k Ä‘Ã£.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.12.55.png)

HÃªn quÃ¡ cÅ©ng cÃ³ ná»™i dung mÃ¬nh cáº§n. Option 1 thÃ¬ nÃ³ dÃ¹ng *7za* Ä‘á»ƒ nÃ©n file nhÆ° mÃ¬nh Ä‘Ã£ tÃ´ tráº¯ng trÃªn hÃ¬nh. Option 2 thÃ¬ nÃ³ dÃ¹ng *mysqldump* Ä‘á»ƒ dump file .sql cÃ¡ch Ä‘Ã³ 2 dÃ²ng. 

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.18.28.png)

NhÃ¬n vÃ o 3 dÃ²ng nÃ y mÃ¬nh Ä‘oÃ¡n lÃ  khi cháº¡y option 1 nÃ³ sáº½ nÃ©n thÆ° má»¥c `/var/www/html` thÃ nh file `/var/backups/project.zip`.
Äiá»u mÃ¬nh quan tÃ¢m á»Ÿ Ä‘Ã¢y lÃ  dáº¥u wildcard `*`. NÃ³ sáº½ thÃªm táº¥t cáº£ cÃ¡c thÆ° má»¥c hoáº·c file á»Ÿ thÆ° má»¥c hiá»‡n táº¡i vÃ o file zip. Váº­y giáº£ sá»­ thÆ° má»¥c hiá»‡n táº¡i chÃ­nh lÃ  thÆ° má»¥c `/root` thÃ¬ sáº½ nhÆ° tháº¿ nÃ o nhá»‰ ?
Idea á»Ÿ Ä‘Ã¢y lÃ  mÃ¬nh sáº½ sá»­ dá»¥ng má»™t symbol link trá» tá»« `/root` Ä‘áº¿n `/var/www/html`.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.33.05.png)

Viá»‡c cÃ²n láº¡i lÃ  mÃ¬nh giáº£i nÃ©n file zip Ä‘Ã³ ra lÃ  sáº½ láº¥y Ä‘Æ°á»£c flag bÃªn trong thÆ° má»¥c `/root`

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.34.32.png)

NhÆ°ng chuyá»‡n khÃ´ng dá»… Ä‘áº¿n tháº¿ mÃ¬nh láº¡i k cÃ³ quyá»n giáº£i nÃ©n nÃ³. Hmmm quay láº¡i Ä‘á»c hÆ°á»›ng dáº«n sá»­ dá»¥ng cá»§a `7za` váº­y.

![Screenshot](/assets/htb/Screenshot 2024-10-15 at 17.43.51.png)

Yeah âœŒğŸ»âœŒğŸ»âœŒğŸ» thÃ nh cÃ´ng. Done.
# Káº¿t luáº­n
## Flag 1
`ba52a4d7c85dc89d0e3433fdfc8d2f58`
## Flag 2
`328080f50550138cc4d1cfeddabf81ac`
